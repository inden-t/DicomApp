# 血管抽出サーフェスモデル構築機能 基本設計

## 2. 基本設計

### 2.1 システム構成
- 既存のDICOMアプリケーションに新機能を追加する形で実装
- WPFフレームワークを使用
- 独自の3Dモデリング機能を実装

### 2.2 主要コンポーネント
1. 3D血管領域選択ツール
2. 血管抽出処理エンジン
3. サーフェスモデル生成エンジン
4. 3Dモデルビューワー
5. 進捗表示コンポーネント

### 2.3 データフロー
1. ユーザーが血管領域選択モードを開始するボタンをクリック
2. システムが3D血管領域選択ツールを有効化
3. ユーザーが3D画像データ上で血管領域を指定
4. 3D領域情報をデータ構造として保存
5. ユーザーが必要に応じて3D領域を編集または削除
6. ユーザーが「血管抽出」ボタンをクリック
7. システムが抽出設定ダイアログを表示
8. ユーザーがしきい値を調整し、「実行」ボタンをクリック
9. 血管抽出処理エンジンが指定された3D領域を取得
10. サーフェスモデル生成エンジンがモデルを生成
11. 生成されたモデルを3Dビューワーで表示
12. ユーザーが「モデル保存」ボタンをクリックしてモデルを保存

### 2.4 主要クラス設計
1. `DicomApp.UseCases.BloodVessel3DRegionSelector`: 3D血管領域選択ツールの実装
2. `DicomApp.UseCases.BloodVesselExtractionUseCase`: 血管抽出処理のロジック
3. `DicomApp.UseCases.BloodVesselSurfaceModelGenerator`: 抽出された3D領域からサーフェスモデルを生成
4. `DicomApp.Models.BloodVessel3DRegion`: 指定された3D血管領域を表すデータ構造
5. `DicomApp.Models.SurfaceModel`: 生成されたサーフェスモデルを表すデータ構造
6. `DicomApp.ViewModels.ProgressViewModel`: 進捗表示用のViewModel

### 2.5 既存システムの拡張
1. `DicomApp.ViewModels.ImageViewerViewModel`: 3D領域選択機能の追加
2. `DicomApp.ViewModels.MainWindowViewModel`: 血管抽出コマンドの追加
3. `DicomApp.Views.Model3dViewer`: 抽出されたモデルの表示機能拡張
4. `DicomApp.Views.ProgressView`: 進捗表示用のView
